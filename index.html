<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <form id="otp-form">
        <div>
            <input type="text" id="otp-1" maxlength="1" required>
            <input type="text" id="otp-2" maxlength="1" required>
            <input type="text" id="otp-3" maxlength="1" required>
            <input type="text" id="otp-4" maxlength="1" required>
            <input type="text" id="otp-5" maxlength="1" required>
            <input type="text" id="otp-6" maxlength="1" required>
        </div>
        <button type="submit">Verify OTP</button>
    </form>

    <div id="otp-fallback" style="display: none;">
        <p>The WebOTP API is not supported in this browser. Please enter the OTP manually.</p>
        <input type="text" id="manual-otp">
        <button type="submit" id="manual-otp-submit">Submit</button>
    </div>
</body>
<script>
    if ('OTPCredential' in window) {
        window.addEventListener('DOMContentLoaded', e => {
            const otpForm = document.querySelector('#otp-form');
            const otpInputs = otpForm.querySelectorAll('input');
            const otpFallback = document.querySelector('#otp-fallback');
            const manualOTPInput = document.querySelector('#manual-otp');

            otpForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                const otp = Array.from(otpInputs).map(input => input.value).join('');
                console.log(otp);
                try {
                    const credential = await navigator.credentials.get({
                        otp: { transport: ['sms'], code: otp }
                    });
                    console.log('Credential:', credential);
                    // Do something with the verified credential
                } catch (error) {
                    console.error('Error verifying OTP:', error);
                    otpFallback.style.display = 'block';
                }
            });

            manualOTPInput.addEventListener('submit', async (event) => {
                event.preventDefault();
                const otp = manualOTPInput.value;
                try {
                    const credential = await verifyOTP(otp);
                    console.log('Credential:', credential);
                    // Do something with the verified credential
                } catch (error) {
                    console.error('Error verifying OTP:', error);
                    otpFallback.style.display = 'block';
                }
            });

            function verifyOTP(otp) {
                return new Promise((resolve, reject) => {
                    const ac = new AbortController();
                    const signal = ac.signal;
                    setTimeout(() => ac.abort(), 30000);

                    navigator.credentials.get({ otp: { transport: ['sms'], code: otp } }, { signal })
                        .then((credential) => {
                            resolve(credential);
                        })
                        .catch((error) => {
                            reject(error);
                        });
                });
            }
        })
    }
</script>

</html>
